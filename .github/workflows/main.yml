name: Profile Maintenance
on:
  schedule:
  - cron: '0 0 * * *' # –ï–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 00:00 UTC
  workflow_dispatch: # –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫
  push:
    branches: [ main ]

jobs:
  update-profile:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'

    - name: Update README with timestamp
      run: |
        # –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –º–µ—Ç–∫—É
        TIMESTAMP=$(date +'%d.%m.%Y –≤ %H:%M UTC')

        # –û–±–Ω–æ–≤–ª—è–µ–º README —Å –≤—Ä–µ–º–µ–Ω–Ω–æ–π –º–µ—Ç–∫–æ–π
        sed -i '/üîÑ –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:/d' README.md
        sed -i '/^---$/a\\nüîÑ **–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** '"$TIMESTAMP" README.md

    - name: Update profile stats
      run: |
        # –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ—Å–ª–µ–¥–Ω–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
        echo "üìä –ü—Ä–æ—Ñ–∏–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏"
        echo "‚è∞ –í—Ä–µ–º—è: $(date)"
        echo "üñ•Ô∏è Runner: ${{ runner.os }}"

    - name: Commit and push changes
      run: |
        git config --global user.name "GitHub Actions Bot"
        git config --global user.email "actions@github.com"
        git add README.md
        git diff --quiet && git diff --staged --quiet || git commit -m "üîÑ Auto-update profile - $(date +'%d.%m.%Y %H:%M')"
        git push

  validate-readme:
    runs-on: ubuntu-latest
    needs: update-profile
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Validate README format
      run: |
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö —Å–µ–∫—Ü–∏–π
        if ! grep -q "## üéØ –û —Å–µ–±–µ" README.md; then
          echo "‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Å–µ–∫—Ü–∏—è '–û —Å–µ–±–µ'"
          exit 1
        fi

        if ! grep -q "## üî≠ –°–µ–π—á–∞—Å —Ä–∞–±–æ—Ç–∞—é –Ω–∞–¥" README.md; then
          echo "‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Å–µ–∫—Ü–∏—è '–°–µ–π—á–∞—Å —Ä–∞–±–æ—Ç–∞—é –Ω–∞–¥'"
          exit 1
        fi

        if ! grep -q "## üõ†Ô∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫" README.md; then
          echo "‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Å–µ–∫—Ü–∏—è '–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫'"
          exit 1
        fi

        echo "‚úÖ README —Ñ–æ—Ä–º–∞—Ç –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω"

    - name: Check for broken links
      run: |
        # –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ http/https —Å—Å—ã–ª–æ–∫
        if grep -q "http[s]*://" README.md; then
          echo "üîó –ù–∞–π–¥–µ–Ω—ã –≤–Ω–µ—à–Ω–∏–µ —Å—Å—ã–ª–∫–∏ –≤ README"
        fi
