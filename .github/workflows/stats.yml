name: Update GitHub Stats
on:
  schedule:
  - cron: '0 6 * * *' # –ï–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 06:00 UTC
  workflow_dispatch:
    # –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

jobs:
  update-stats:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    - name: Install dependencies
      run: |
        pip install requests beautifulsoup4

    - name: Update GitHub stats
      run: |
        python -c "
        import requests
        import json
        from datetime import datetime

        # GitHub API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        username = 'thefilikr'
        api_url = f'https://api.github.com/users/{username}'

        try:
            response = requests.get(api_url)
            if response.status_code == 200:
                user_data = response.json()
                print(f'‚úÖ GitHub —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞')
                print(f'üìä –ü—É–±–ª–∏—á–Ω—ã—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤: {user_data.get(\"public_repos\", 0)}')
                print(f'üë• –ü–æ–¥–ø–∏—Å—á–∏–∫–æ–≤: {user_data.get(\"followers\", 0)}')
                print(f'üìÖ –°–æ–∑–¥–∞–Ω: {user_data.get(\"created_at\", \"N/A\")}')
            else:
                print(f'‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö: {response.status_code}')
        except Exception as e:
            print(f'‚ùå –û—à–∏–±–∫–∞: {e}')
        "

    - name: Update README with stats info
      run: |
        # –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ—Å–ª–µ–¥–Ω–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        STATS_TIME=$(date +'%d.%m.%Y –≤ %H:%M UTC')
        echo "üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞: $STATS_TIME"

        # –û–±–Ω–æ–≤–ª—è–µ–º README –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
        if ! grep -q "üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞:" README.md; then
          sed -i '/^---$/a\\nüìà **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞:** '"$STATS_TIME" README.md
        fi

    - name: Commit stats update
      run: |
        git config --global user.name "GitHub Stats Bot"
        git config --global user.email "stats@github.com"
        git add README.md
        git diff --quiet && git diff --staged --quiet || git commit -m "üìà Auto-update GitHub stats - $(date +'%d.%m.%Y %H:%M')"
        git push 
